<!DOCTYPE html>
<html>
<head>
    <title>Treinamento ITIL V4</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="styles.css" /> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let respostasCorretas = [];
        let respostasSelecionadas = [];

        function embaralharConteudo() {
            const perguntas = [
                {
                    texto: "O que é ITIL 4?",
                    respostas: [
                        "Um Framework para desenvolvimento de software.",
                        "Uma abordagem para gerenciamento de serviços de TI que se concentra na co-criação de um valor.",
                        "Um padrão de segurança da informação.",
                        "Todas respostas"
                    ],
                    correta: 1 // índice da resposta correta
                },
                {
                    texto: "Qual das seguintes opções é uma das quatro dimensões do gerenciamento de serviços?",
                    respostas: [
                        "Gerenciamento de mudanças.",
                        "Informações e Tecnologia.",
                        "Desempenho de serviços.",
                        "Todas respostas"
                    ],
                    correta: 2
                },
                {
                    texto: "O que é um fluxo de valor?",
                    respostas: [
                        "Um conjunto de atividades que transforma insumos em resultados.",
                        "Uma lista de serviços oferecidos pela TI.",
                        "Um processo de melhoria contínua.",
                        "Todas respostas"
                    ],
                    correta: 0
                },
                {
                    texto: "Qual princípio do ITIL 4 diz que 'focar no valor'?",
                    respostas: [
                        "Começar onde você está.",
                        "Focar no valor.",
                        "Colaborar e promover visibilidade.",
                        "Todas respostas"
                    ],
                    correta: 1
                },
                {
                    texto: "O que é o Sistema de Valor do Serviço (SVS)?",
                    respostas: [
                        "Um conjunto de práticas que suportam a operação de TI.",
                        "Um modelo que descreve como todos os componentes e atividades de uma organização trabalham juntos.",
                        "Uma ferramenta de monitoramento de serviços.",
                        "Todas respostas"
                    ],
                    correta: 1
                },
                {
                    texto: "Qual pratica é responsável por implementar componentes em ambientes de produção?",
                    respostas: [
                        "Habilitação de mudança",
                        "Gerenciamento de liberação",
                        "Gerenciamento de ativos de TI",
                        "Gerenciamento de implantação"
                    ],
                    correta: 3
                },
                {
                    texto: "Qual pratica abrange a classificação e a propriedade de consultas e requisições dos usuários?",
                    respostas: [
                        "Central de serviços",
                        "Gerencimento de incidente",
                        "Habilitação de mudança",
                        "Gerenciamento de nível de serviço"
                    ],
                    correta: 0
                },
                {
                    texto: "Qual prática identifica métricas que refletem a experiência do cliente em um serviço?",
                    respostas: [
                        "Melhoria contínua",
                        "Central de serviços",
                        "Gerenciamento de nível de serviço",
                        "Gerenciamento de problema"
                    ],
                    correta: 2
                },
                {
                    texto: "Qual é principal uso de um calendário de mudanças?",
                    respostas: [
                        "Suportar o 'gerenciamento de incidente' e o planejamento da melhoria",
                        "Gerenciar mudanças emergenciais",
                        "Planejar mudanças e ajudar a evitar conflitos",
                        "Gerenciar mudanças padrão"
                    ],
                    correta: 2
                },
                {
                    texto: "Qual dimensão do gerenciamento de serviço se concentra nas atividades e em como elas são coordenadas?",
                    respostas: [
                        "Organização e pessoas",
                        "Informação e tecnologia",
                        "Parceiros e fornecedores",
                        "Fluxos de valor e processos"
                    ],
                    correta: 3
                }
            ];

            // Embaralha as perguntas
            perguntas.sort(() => Math.random() - 0.5);

            perguntas.forEach(function(pergunta, index) {
                const respostas = pergunta.respostas.slice(); // Cria uma cópia para embaralhar
                const correta = pergunta.correta;
                respostas.sort(() => Math.random() - 0.5); // Embaralha as respostas aleatoriamente

                // Armazena a posição da resposta correta após o embaralhamento
                const respostaCorretaEmbaralhada = respostas.indexOf(pergunta.respostas[correta]);
                respostasCorretas.push(respostaCorretaEmbaralhada);

                // Seleciona o campo para inserir a pergunta e as respostas
                const divPergunta = document.createElement('fieldset');
                const legenda = document.createElement('legend');
                legenda.innerHTML = `<strong>Pergunta ${index + 1}:</strong> ${pergunta.texto}`;
                divPergunta.appendChild(legenda);

                // Atribui as respostas embaralhadas aos elementos
                respostas.forEach((resposta, i) => {
                    const label = document.createElement('label');
                    label.classList.add('resposta');
                    label.innerHTML = `<input type="radio" name="pergunta${index + 1}" value="${i}"> ${resposta}`;
                    divPergunta.appendChild(label);
                    divPergunta.appendChild(document.createElement('br')); // Quebra de linha
                });

                // Adiciona o conjunto de perguntas à página
                document.querySelector('.content').appendChild(divPergunta);
            });
        }

        function verificarRespostas() {
            let acertos = 0;
            let erros = 0;

            if (window.confirm("Confirma envio das respostas?") === true) {
                // Verifica as respostas selecionadas
                respostasCorretas.forEach((respostaCorreta, index) => {
                    const respostaSelecionada = document.querySelector(`input[name="pergunta${index + 1}"]:checked`);

                    if (respostaSelecionada) {
                        const valorSelecionado = parseInt(respostaSelecionada.value);
                        respostasSelecionadas.push(valorSelecionado);

                        if (valorSelecionado === respostaCorreta) {
                            acertos++;
                        } else {
                            erros++;
                        }
                    } else {
                        erros++; // Se não houver resposta, conta como erro
                    }
                });

                // Envia as respostas via fetch
                enviarResultados(acertos, erros);
            } 
        }

        function mostrarDiv() {
            var div = document.getElementById('Resp');
            div.style.display = 'block';
        }

        function enviarResultados(acertos, erros) {
            // Dados para enviar via fetch
            const dados = {
                acertos: acertos,
                erros: erros
            };

            // Envia para o servidor ( endpoint fictício, pode ser alterado conforme necessário)
            fetch('https://jsonplaceholder.typicode.com/posts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Resposta do servidor:', data);
                alert("Resultado enviado com sucesso!");
                
                //mostra div grafico oculta
                mostrarDiv();
                // Após enviar, exibe o gráfico com os resultados
                exibirGrafico(acertos, erros);

            })
            .catch(error => {
                console.error('Erro ao enviar os dados:', error);
                alert("Erro ao enviar os dados.");
            });
        }

        function exibirGrafico(acertos, erros) {
            const ctx = document.getElementById('grafico').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Acertos', 'Erros'],
                    datasets: [{
                        label: 'Resultados',
                        data: [acertos, erros],
                        backgroundColor: ['#4caf50', '#f44336'],
                        borderColor: ['#388e3c', '#d32f2f'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
    </script>
</head>
<body onload="embaralharConteudo()">
    <div class="content">
        <h1>Treinamento simulado ITIL V4</h1>
    </div>
    <div>
        <button onclick="window.location.reload()">Limpar Respostas</button> 
        <button onclick="verificarRespostas()">Enviar Respostas</button>
    </div>
    <div id="Resp" hidden>
         <h2>Resultados</h2>
         <canvas id="grafico" width="200" height="200"></canvas>
    </div>
    <footer>
        <p>&#169; copyright 2024 Desenvolvido por Marcio M. Araujo</p>
    </footer>
</body>
</html>
